name: IrO2 CI (state generation)

on:
  push:
    paths:
      - "scripts/generate_states.py"
      - "scripts/run_state_optimizations.py"
      - "scripts/potential_window.py"
      - "inputs/state_set.json"
      - ".github/workflows/python-package-conda.yml"
      - "inputs/slab_clean_2x2.in"
  workflow_dispatch:

permissions:
  contents: read

jobs:
  generate-states:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Miniconda
        uses: conda-incubator/setup-miniconda@v3
        with:
          auto-update-conda: true
          environment-file: environment.yml
          activate-environment: iro2
          auto-activate-base: false

      - name: Generate state structures
        shell: bash -l {0}
        run: |
          set -euo pipefail
          mkdir -p outputs
          python scripts/generate_states.py --state_set inputs/state_set.json --outputs outputs
          echo "Generated structures:"
          find outputs/states -maxdepth 4 -type f | head -n 200

      - name: Upload generated states
        uses: actions/upload-artifact@v4
        with:
          name: generated-states
          path: outputs/states/

